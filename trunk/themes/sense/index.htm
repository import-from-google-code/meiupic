{template block/header}
<script src="{$style_path}jquery.masonry.min.js" type="text/javascript"></script>
<script src="{$style_path}jquery.infinitescroll.min.js" type="text/javascript"></script>
<div id="bodywrap" class="mainbody">
	{php $sort=getGet('sort','tu_desc');}
	<div id="index_menu">
		<ul>
			<li {if $sort=='tu_desc'}class="current"{/if}><a href="{link ctl=default}">{lang new_pictures}</a></li>
			<li {if $sort=='h_desc'}class="current"{/if}><a href="{link ctl=default sort=h_desc}">{lang hot_pictures}</a></li>
			<li><a href="{link ctl=albums}">{lang all_albums}</a></li>
		</ul>
	</div>
    
    <div id="waterfall">
    {php $urlrule=site_link('default','index',array('page'=>'[#page#]'));}
    {mp:photo action=lists order=$sort is_open=1 num=20 page=`getGet('page')` urlrule=$urlrule}
        {if $total_page<getGet('page')}
            {php header('HTTP/1.1 404 Not Found');}
        {/if}
        {loop $data $photo}
        <div class="box photo">
            <a href="{link ctl=photos act=view id=$photo['id']}"><img src="{$base_path}img.php?w=218&path={echo urlencode($photo['path']);}&cache=1" alt="{$photo['name']}" /></a>
            <p class="description">{$photo['desc']}</p>
        </div>
        {/loop}
    {/mp}
    </div>
    <div id="page-nav" class="paginator">
      {$pages}
    </div>
</div>
<a id="elevator" href="#" onclick="return false;"><strong>{lang back_to_top}</strong><span></span></a>
<script type="text/javascript">
 $(function(){
    
    var $container = $('#waterfall');
    
    $container.imagesLoaded(function(){
      $container.masonry({
        itemSelector: '.box',
        columnWidth: function( containerWidth ) {
            return containerWidth / 4;
        },
        isAnimated: true,
        animationOptions: {
            duration: 300
        }
      });
    });

    
    $container.infinitescroll({
      navSelector  : '#page-nav',
      nextSelector : '#page-nav span.next a', 
      itemSelector : '.box',
      loading: {
          finishedMsg: "<em>{lang no_more_pictures}</em>",
          img: "{$style_path}images/cloading.gif",
          msgText: "<em>{lang loading}</em>"
        }
      },
      function( newElements ) {
        var $newElems = $( newElements ).css({ opacity: 0 });
        $newElems.imagesLoaded(function(){
          $newElems.animate({ opacity: 1 });
          $container.masonry( 'appended', $newElems, true ); 
        });
      }
    );
    $('#page-nav').hide();
    
	if( !(jQuery.browser.msie && jQuery.browser.version < 7) ){//not ie6
		$(window).scroll(function(){
			var documentTop = parseInt($(document).scrollTop())+100; 
			if(documentTop > 100) {
				$('#elevator').show();
			}else{
				$('#elevator').hide();
			}
		});
		$('#elevator').click(function(){
			$("html, body").animate({ scrollTop: 0 }, 120);
		});
	}
});
	
</script>
{template block/footer}