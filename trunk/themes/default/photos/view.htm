{template block/header}
<div id="bodywrap">
    <table class="layout">
        <tr>
            <td class="left">
                <div class="mainbody">
                    <div class="col titbg">
                        <h1 class="f_left">查看照片</h1>
                        <h4 class="f_left"></h4>
                        {$photo_col_ctl}
                    </div>
                    <div class="innercol grid">
                        <div id="pic_block" class="tbmu">
                            <span class="f_left"><a href="{link ctl=photos act=index aid=$info['album_id']}">返回相册列表</a></span>
                            <div class="f_right">
                                {if $picture['first']}<a href="{link ctl=photos act=view id=$picture['first']['id']}#pic_block">第一张</a>{else}第一张{/if}
                                <span class="pipe">|</span>
                                {if $picture['previous']}<a href="{link ctl=photos act=view id=$picture['previous']['id']}#pic_block" class="btnprev">上一张</a>{else}上一张{/if}
                                <span class="pipe">|</span>
                                {if $picture['next']}<a href="{link ctl=photos act=view id=$picture['next']['id']}#pic_block" class="btnnext">下一张</a>{else}下一张{/if}
                                <span class="pipe">|</span>
                                {if $picture['last']}<a href="{link ctl=photos act=view id=$picture['last']['id']}#pic_block">最后张</a>{else}最后张{/if}
                                <span class="pipe">|</span>
                                <span class="i_slideshow sprite"></span> <a href="{link ctl=photos act=slide aid=$info['album_id']}">幻灯浏览</a>
                            </div>
                        </div>
                        
                        <div id="photo_body">
                            <img class="photo" alt="{$info['name']}" src="{$info['thumb']}" />
                            <div class="ctl"><div class="prev"><span>上一张</span></div><div class="next"><span>下一张</span></div></div>
                        </div>
                        <div id="photo_infos">
                            <div class="photo_others">
                                <p>上传于: {echo date('Y-m-d',$info['create_time'])}</p>
                                <!--{if $info['taken_time']}-->
                                <p>拍摄于: {echo date('Y-m-d',$info['taken_time'])}</p>
                                <!--{/if}-->
                                <p><a href="#">更多Exif信息</a></p>
                                <p>被查看了{$info['hits']}次</p>
                                <p><a href="{$info['path']}" target="_blank">查看原图</a></p>
                            </div>
                            <div class="photo_main">
                                <h1>
                                    <div class="inline_edit" title="点击可编辑" onclick="Madmin.inline_edit(this,'{link ctl=photos act=modify_name_inline id=$info['id']}')">{$info['name']} <span class="i_editinfo sprite"></span>
                                    </div>
                                </h1>
                                <div class="desc">
                                    <div class="inline_edit" title="点击可编辑" onclick="Madmin.inline_edit(this,'{link ctl=photos act=modify_desc_inline id=$info['id']}')"><!--{if !$info['desc']}-->
                                        还没有描述，为照片添加描述吧！
                                        <!--{else}-->
                                        {$info['desc']}
                                        <!--{/if}--> <span class="i_editinfo sprite"></span>
                                    </div>
                                </div>
                                <div class="tags">
                                    <div class="inline_edit" title="点击可编辑" onclick="Madmin.inline_edit(this,'{link ctl=photos act=modify_tags_inline id=$info['id']}')"> 标签: <!--{if !$info['tags']}-->点击添加标签吧！<!--{else}-->{$info['tags']}<!--{/if}--><span class="i_editinfo sprite"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
<script>
   function detect_resize_img(){
       var max_width = $('body').width()-350;
       var img_width = parseInt('{$info['width']}');
       if(isNaN(img_width)){
           img_width = 600;
       }
       if(img_width > max_width){
           img_width = max_width;
       }
       $('#photo_body img.photo').attr('width',img_width);
   }
   function show_pic_ctl(){
       var photo_obj = $('#photo_body img.photo');
       var pos = photo_obj.offset();
       var i_height = photo_obj.outerHeight();
       var i_width = photo_obj.outerWidth();
       var w = i_width/2;
       var ctl_obj = $('#photo_body div.ctl');
       ctl_obj.css({ left:pos.left,top:pos.top, width:i_width, height:i_height });
       {if $picture['previous']}
       ctl_obj.find('div.prev').css({ height:i_height,width:w }).show().hover(function(){
           $(this).find('span').css('display','block');
       },function(){
           $(this).find('span').css('display','none');
       }).click(function(){
           window.location.href = $('#pic_block a.btnprev').attr('href');
       });
       {/if}
       {if $picture['next']}
       ctl_obj.find('div.next').css({ height:i_height,width:w }).show().hover(function(){
          $(this).find('span').css('display','block');
       },function(){
          $(this).find('span').css('display','none');
       }).click(function(){
           window.location.href = $('#pic_block a.btnnext').attr('href');
       });
       {/if}
   }
   
   detect_resize_img();
   var img = new Image();
   img.onload = function(){
       $('#photo_body img.photo').attr('src',img.src);
       show_pic_ctl();
   };
   img.src = "{$info['path']}";
   
   $(window).resize(function() {
       detect_resize_img();
       show_pic_ctl();
   });
   
   $(document).bind('keydown',
       function(e){
           if (e.altKey) return true;
           var target = e.target;
           if (target && target.type) return true;
           switch(e.keyCode) {
               case 63235: case 39: 
               if ($("#pic_block").find("a.btnnext").length > 0){
                    window.location=$('#pic_block a.btnnext').attr('href');
                    return false; 
               } break;
               case 63234: case 37:
               if ($("#pic_block").find("a.btnprev").length > 0){
                   window.location=$('#pic_block a.btnprev').attr('href');
                   return false; 
               } break;
           }
       }
   );
</script>
                        <div class="col titbg">
                            <h1 class="f_left">{lang all_photo_comments}</h1>
                            <h4 class="f_left">{lang comments_num|`$info['comments_num']`}</h4>
                        </div>
                        <div class="innetcol">
                            <div class="comment_form">
                                <form id="photo_comment_form" action="{link ctl=comments act=post}" method="post" onsubmit="return false;">
                                    <input type="hidden" name="ref_id" value="{$ref_id}" />
                                    <input type="hidden" name="type" value="{$comments_type}" />
                                    <div class="field">
                                        <div class="label">{lang email}</div>
                                        <div class="ipts"><input type="text" class="inputstyle iptw2" name="email" /></div>
                                        <div class="clear"></div>
                                    </div>
                                    <div class="field">
                                        <div class="label">{lang comment_user} *</div>
                                        <div class="ipts"><input type="text" class="inputstyle iptw2" name="author" /></div>
                                        <div class="clear"></div>
                                    </div>
                                    <div class="field">
                                        <div class="label">{lang comment_content} *</div>
                                        <div class="ipts"><textarea class="inputstyle ipttextarea" name="content"></textarea></div>
                                        <div class="clear"></div>
                                    </div>
                                    <div class="field">
                                        <div class="label"> &nbsp;</div>
                                        <div class="ipts"><input type="submit" name="submit" class="ylbtn f_left" value="发表评论" onclick="Mui.box.callback=function(){ reload_comments('{link ctl=comments act=more ref_id=$ref_id type=$comments_type}');$('#photo_comment_form').get(0).reset(); };Mui.form.sendAuto('photo_comment_form');" /></div>
                                        <div class="clear"></div>
                                    </div>
                                </form>
                            </div>
                            <a name="comments"></a>
                            <div class="comment_list">
                                {template comments/more}
                            </div>
                            <div class="clear"></div>
                        </div>
                        
                        
                    </div>
                </div>
            </td>
            <td class="right">
                <div class="sidebar">
                    <div class="pic_nav">
                        <div class="title"><a href="{link ctl=photos act=index aid=$info['album_id']}">{$album_info['name']}</a> [相册]</div>
                        <div class="body">
                            <div>
                                {if $picture['previous']}
                                <a href="{link ctl=photos act=view id=$picture['previous']['id']}#pic_block" class="turn_page_up">上一张</a>
                                {else}
                                <a href="javascript:void(0);" class="turn_page_up">这是首张</a>
                                {/if}
                            </div>
                            <ul>
                                {if $picture['previous']}
                                <li><a href="{link ctl=photos act=view id=$picture['previous']['id']}#pic_block" style="background:url('{$picture['previous']['thumb']}') center;"></a></li>
                                {else}
                                <li><a href="javascript:void(0);">这是首张</a></li>
                                {/if}
                                <li class="current"><a href="javascript:void(0);" style="background:url('{$info['thumb']}') center"></a></li>
                                {if $picture['next']}
                                <li><a href="{link ctl=photos act=view id=$picture['next']['id']}#pic_block" style="background:url('{$picture['next']['thumb']}') center"></a></li>
                                {else}
                                <li><a href="javascript:void(0);">这是末张</a></li>
                                {/if}
                            </ul>
                            <div>
                                {if $picture['next']}
                                <a href="{link ctl=photos act=view id=$picture['next']['id']}#pic_block" class="turn_page_down">下一张</a>
                                {else}
                                <a href="javascript:void(0);" class="turn_page_down">这是末张</a>
                                {/if}
                            </div>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
    </table>
</div>
{template block/footer}